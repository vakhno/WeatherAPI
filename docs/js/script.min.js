"use strict";var api={url:"http://api.openweathermap.org/data/2.5/",key:"b7bf80efafd4a87d928b38d509b14759"},appendNumber=1,current=0,countOfDays=0,countOfHours=0,newDayNumber=0;function createFirstCard(e,t){countOfDays=0,newDayNumber=0,document.querySelector(".weather-API__addNewDay")&&document.querySelector(".weather-API__addNewDay").remove();var r=document.createElement("div");r.classList.add("weather-card"),r.dataset.weatherCounter,r.dataset.weatherCounter=newDayNumber,r.dataset.cardNumber,r.dataset.cardNumber=0,r.classList.add("new-card-number-0"),document.querySelector(".weather-API__cards").prepend(r);var a=document.createElement("div");a.classList.add("weather-card__info"),document.querySelector(".weather-card").prepend(a);var c=document.createElement("div");c.classList.add("weather-card__place"),document.querySelector(".weather-card__info").prepend(c);var n=document.createElement("div");n.classList.add("weather-card__city"),document.querySelector(".weather-card__place").prepend(n);var d=document.createElement("sup");d.classList.add("weather-card__country"),document.querySelector(".weather-card__city").after(d);var o=document.createElement("div");o.classList.add("weather-card__time"),document.querySelector(".weather-card__place").after(o);var u=document.createElement("div");u.classList.add("weather-card__temperature"),document.querySelector(".weather-card__time").after(u);var s=document.createElement("div");s.classList.add("weather-card__real-degree"),document.querySelector(".weather-card__temperature").prepend(s);var i=document.createElement("div");i.classList.add("weather-card__feels-degree"),document.querySelector(".weather-card__real-degree").after(i);var l=document.createElement("button");l.classList.add("weather-API__addNewDay"),l.textContent="add new day",document.querySelector(".weather-API__cards").after(l);var _=document.createElement("div");_.classList.add("weather-card__changeHours"),document.querySelector(".weather-card__info").after(_);var m=document.createElement("button");m.textContent="+3 hours",m.classList.add("weather-card__plus3Hours"),document.querySelector(".weather-card__changeHours").prepend(m);var w=document.createElement("button");w.textContent="-3 hours",w.classList.add("weather-card__minus3Hours"),document.querySelector(".weather-card__plus3Hours").before(w);var h=document.createElement("div");h.classList.add("weather-card__icon"),document.querySelector(".weather-card__temperature").after(h);var p=document.createElement("div");p.classList.add("weather-card__status"),document.querySelector(".weather-card__icon").after(p),console.log(t.weather[0].icon),document.querySelector(".weather-card__city").textContent=e.city.name,document.querySelector(".weather-card__country").textContent=e.city.country,document.querySelector(".weather-card__time").textContent=t.dt_txt,document.querySelector(".weather-card__real-degree").innerHTML=(t.main.temp-273).toFixed(1)+"&deg",document.querySelector(".weather-card__feels-degree").innerHTML="feels like: "+(t.main.feels_like-273).toFixed(1)+"&deg",document.querySelector(".weather-card__icon").innerHTML="<img src='https://openweathermap.org/img/wn/".concat(t.weather[0].icon,"@2x.png'>"),document.querySelector(".weather-card__status").textContent=t.weather[0].description}document.querySelector(".input").addEventListener("keypress",(function(e){return 13===e.keyCode?getWeather(this.value):0}));var newInfoCard=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r)t=r.target.parentNode.parentNode.classList[1];else{var a=document.createElement("div");(a=document.querySelector(".weather-card").cloneNode(!0)).classList.remove("new-card-number-0"),a.classList.add("new-card-number-".concat(countOfDays)),a.dataset.cardNumber=countOfDays,a.dataset.weatherCounter=newDayNumber,1==countOfDays?document.querySelector(".weather-card").after(a):document.querySelector(".new-card-number-".concat(countOfDays-1)).after(a),t="new-card-number-".concat(countOfDays)}document.querySelector(".".concat(t," > .weather-card__info > .weather-card__time")).innerHTML=e.dt_txt,document.querySelector(".".concat(t," > .weather-card__info > .weather-card__temperature > .weather-card__real-degree")).innerHTML=(e.main.temp-273).toFixed(1)+"&deg",document.querySelector(".".concat(t," > .weather-card__info > .weather-card__temperature > .weather-card__feels-degree")).innerHTML="feels like: "+(e.main.feels_like-273).toFixed(1)+"&deg",document.querySelector(".".concat(t," > .weather-card__info > .weather-card__icon")).innerHTML="<img src='https://openweathermap.org/img/wn/".concat(e.weather[0].icon,"@2x.png'>"),document.querySelector(".".concat(t," > .weather-card__info > .weather-card__status")).innerHTML=e.weather[0].description},getWeather=function(e){fetch("".concat(api.url,"forecast?q=").concat(e,"&inits=metric&APPID=").concat(api.key)).then((function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t})).then((function(e){return e.json()})).then(displayWeather).catch((function(e){console.log("Error: "+e.message),console.log(e.response)}))};function displayWeather(e){for(var t=document.querySelector(".weather-API__cards");t.firstChild;)t.removeChild(t.firstChild);createFirstCard(e,e.list[0]),document.querySelector(".weather-API__addNewDay").onclick=function(t){var r=+e.list[newDayNumber].dt_txt.split(" ",2)[0].split("-")[2],a=+e.list[newDayNumber].dt_txt.split("-",2)[1],c=+e.list[newDayNumber].dt_txt.split("-",2)[0];if(++countOfDays<4){var n=e.list.find((function(e,t){var n=e.dt_txt.split(" ",2)[0].split("-")[2],d=e.dt_txt.split("-",2)[1],o=e.dt_txt.split("-",2)[0];if(newDayNumber=t,n<r&&d>a||n>r&&d==a||o>c&&d<a)return e}));newInfoCard(n)}else t.target.style.display="none",countOfDays=0,newDayNumber=0},document.querySelector(".weather-API__cards").onclick=function(t){if(t.target.matches("button.weather-card__plus3Hours")){t.target.parentNode.parentNode.getAttribute("data-weather-counter");var r=+document.querySelector(".".concat(t.target.parentNode.parentNode.classList[1]," > .weather-card__info > .weather-card__time")).textContent.split(" ",2)[0].split("-")[2],a=+document.querySelector(".".concat(t.target.parentNode.parentNode.classList[1]," > .weather-card__info > .weather-card__time")).textContent.split(" ",2)[1].split(":")[0],c=e.list.find((function(e,t){if(+e.dt_txt.split(" ",2)[1].split(":")[0]>a&&+e.dt_txt.split(" ",2)[0].split("-")[2]===r)return console.log("+"),e}));if(void 0===c)return 0;newInfoCard(c,t)}else{if(!t.target.matches("button.weather-card__minus3Hours"))return!1;t.target.parentNode.parentNode.getAttribute("data-weather-counter");var n=+document.querySelector(".".concat(t.target.parentNode.parentNode.classList[1]," > .weather-card__info > .weather-card__time")).textContent.split(" ",2)[0].split("-")[2],d=+document.querySelector(".".concat(t.target.parentNode.parentNode.classList[1]," > .weather-card__info > .weather-card__time")).textContent.split(" ",2)[1].split(":")[0],o=e.list.find((function(e,t){if(d-+e.dt_txt.split(" ",2)[1].split(":")[0]==3&&+e.dt_txt.split(" ",2)[0].split("-")[2]===n)return console.log("-"),e}));if(void 0===o)return 0;newInfoCard(o,t)}}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJhcGkiLCJ1cmwiLCJrZXkiLCJhcHBlbmROdW1iZXIiLCJjdXJyZW50IiwiY291bnRPZkRheXMiLCJjb3VudE9mSG91cnMiLCJuZXdEYXlOdW1iZXIiLCJjcmVhdGVGaXJzdENhcmQiLCJjaXR5IiwiaW5mbyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInJlbW92ZSIsImNhcmQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsIndlYXRoZXJDb3VudGVyIiwiY2FyZE51bWJlciIsInByZXBlbmQiLCJjYXJkSW5mbyIsImNhcmRQbGFjZSIsImNhcmRDaXR5IiwiY2FyZENvdW50cnkiLCJhZnRlciIsImNhcmRUaW1lIiwiY2FyZFRlbXBlcmF0dXJlIiwidGVtcGVyYXR1cmVSZWFsIiwidGVtcGVyYXR1cmVGZWVsIiwiYnV0dG9uQWRkRGF5IiwidGV4dENvbnRlbnQiLCJjaGFuZ2VIb3VycyIsImJ1dHRvblBsdXMzSG91cnMiLCJidXR0b25NaW51czNIb3VycyIsImJlZm9yZSIsIndlYXRoZXJJY29uIiwiY2FyZFN0YXR1cyIsImNvbnNvbGUiLCJsb2ciLCJ3ZWF0aGVyIiwiaWNvbiIsIm5hbWUiLCJjb3VudHJ5IiwiZHRfdHh0IiwiaW5uZXJIVE1MIiwibWFpbiIsInRlbXAiLCJ0b0ZpeGVkIiwiZmVlbHNfbGlrZSIsImNvbmNhdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleUNvZGUiLCJnZXRXZWF0aGVyIiwidGhpcyIsInZhbHVlIiwibmV3SW5mb0NhcmQiLCJvdXRwdXRDYXJkIiwiYnV0dG9uIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsIm5ld0NhcmREaXYiLCJjbG9uZU5vZGUiLCJlIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwic3RhdHVzIiwiZXJyb3IiLCJFcnJvciIsInN0YXR1c1RleHQiLCJyZXNwb25zZSIsImRhdGEiLCJqc29uIiwiZGlzcGxheVdlYXRoZXIiLCJtZXNzYWdlIiwiYWxsQ2FyZHNCbG9jayIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsImxpc3QiLCJvbmNsaWNrIiwiZGF5Iiwic3BsaXQiLCJtb3VudGgiLCJ5ZWFyIiwibmV4dERheUluZm8iLCJmaW5kIiwiaXRlbSIsImluZGV4IiwibmV3RGF5IiwibmV3TW91bnRoIiwibmV3WWVhciIsInN0eWxlIiwiZGlzcGxheSIsIm1hdGNoZXMiLCJnZXRBdHRyaWJ1dGUiLCJob3VyIiwibmV4dEhvdXJJbmZvIiwiaSJdLCJtYXBwaW5ncyI6IkFBQUEsYUFBQSxJQUFNQSxJQUFNLENBQ1JDLElBQUcsMENBQ0hDLElBQUcsb0NBRUhDLGFBQWUsRUFDZkMsUUFBVSxFQUNWQyxZQUFjLEVBQ2RDLGFBQWUsRUFDZkMsYUFBZSxFQU1uQixTQUFTQyxnQkFBZ0JDLEVBQU1DLEdBQzNCTCxZQUFjLEVBQ2RFLGFBQWUsRUFDZEksU0FBU0MsY0FBYyw0QkFBOEJELFNBQVNDLGNBQWMsMkJBQTJCQyxTQUV4RyxJQUFJQyxFQUFPSCxTQUFTSSxjQUFULE9BQ1hELEVBQUtFLFVBQVVDLElBQWYsZ0JBQ0FILEVBQUtJLFFBQVFDLGVBQ2JMLEVBQUtJLFFBQVFDLGVBQWlCWixhQUM5Qk8sRUFBS0ksUUFBUUUsV0FDYk4sRUFBS0ksUUFBUUUsV0FBYSxFQUMxQk4sRUFBS0UsVUFBVUMsSUFBZixxQkFDQU4sU0FBU0MsY0FBVCx1QkFBOENTLFFBQVFQLEdBRXRELElBQUlRLEVBQVdYLFNBQVNJLGNBQVQsT0FDZk8sRUFBU04sVUFBVUMsSUFBbkIsc0JBQ0FOLFNBQVNDLGNBQVQsaUJBQXdDUyxRQUFRQyxHQUVoRCxJQUFJQyxFQUFZWixTQUFTSSxjQUFULE9BQ2hCUSxFQUFVUCxVQUFVQyxJQUFwQix1QkFDQU4sU0FBU0MsY0FBVCx1QkFBOENTLFFBQVFFLEdBRXRELElBQUlDLEVBQVdiLFNBQVNJLGNBQVQsT0FDZlMsRUFBU1IsVUFBVUMsSUFBbkIsc0JBQ0FO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VSxHQUFwRSxpREFBc0hnQixZQUFZdUQsTUFBbEksSUFBNkksR0FBRyxHQUFHQSxNQUFuSixLQUE4SixHQUV0S2UsRUFBZ0J6QixFQUFLTyxLQUFNTyxNQUFLLFNBQUNDLEVBQU1XLEdBQ3ZDLEdBQU1GLEdBQVFULEVBQUsvQyxPQUFPMEMsTUFBWixJQUF1QixHQUFHLEdBQUdBLE1BQTdCLEtBQXdDLElBQVEsSUFBUUssRUFBSy9DLE9BQU8wQyxNQUFaLElBQXVCLEdBQUcsR0FBR0EsTUFBN0IsS0FBd0MsS0FBT0QsRUFFakgsT0FEQS9DLFFBQVFDLElBQVIsS0FDT29ELEtBSWYsUUFBcUI3QixJQUFqQnVDLEVBQ0EsT0FBTyxFQUVYNUMsWUFBWTRDLEVBQWNsQyIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBhcGkgPSB7XHJcbiAgICB1cmw6IGBodHRwOi8vYXBpLm9wZW53ZWF0aGVybWFwLm9yZy9kYXRhLzIuNS9gLFxyXG4gICAga2V5OiBgYjdiZjgwZWZhZmQ0YTg3ZDkyOGIzOGQ1MDliMTQ3NTlgLFxyXG59O1xyXG52YXIgYXBwZW5kTnVtYmVyID0gMTtcclxubGV0IGN1cnJlbnQgPSAwO1xyXG5sZXQgY291bnRPZkRheXMgPSAwOyAgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0LTQvdC10Lkg0LTQu9GPINCy0YvQstC+0LTQsFxyXG5sZXQgY291bnRPZkhvdXJzID0gMDsgLy8g0LTQu9GPINC/0L7QtNGB0YfQtdGC0LAg0LrQvtC7LdCy0L4g0YfQsNGB0L7QsiDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQsNC90LjRjyAtM2hvdXJzXHJcbmxldCBuZXdEYXlOdW1iZXIgPSAwOyAvLyDQtNC70Y8g0L/QvtC40YHQutCwINGB0LvQtdC00YPRjtGI0LXQs9C+INC00L3RjyDQsiDQvNCw0YHQuNGB0LjQstC1IGxpc3QgKNC/0YDQuNGB0LLQsNC40LLQsNC10YLRgdGPINC40L3QtNC10LrRgSDQvNCw0YHRgdC40LLQsClcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5pbnB1dGApLmFkZEV2ZW50TGlzdGVuZXIoYGtleXByZXNzYCwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICByZXR1cm4gKGV2ZW50LmtleUNvZGUgPT09IDEzKSA/IGdldFdlYXRoZXIodGhpcy52YWx1ZSkgOiAwO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUZpcnN0Q2FyZChjaXR5LCBpbmZvKSB7XHJcbiAgICBjb3VudE9mRGF5cyA9IDA7XHJcbiAgICBuZXdEYXlOdW1iZXIgPSAwO1xyXG4gICAgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53ZWF0aGVyLUFQSV9fYWRkTmV3RGF5JykpID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndlYXRoZXItQVBJX19hZGROZXdEYXknKS5yZW1vdmUoKSA6IG51bGw7XHJcblxyXG4gICAgbGV0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBkaXZgKTtcclxuICAgIGNhcmQuY2xhc3NMaXN0LmFkZChgd2VhdGhlci1jYXJkYCk7XHJcbiAgICBjYXJkLmRhdGFzZXQud2VhdGhlckNvdW50ZXI7XHJcbiAgICBjYXJkLmRhdGFzZXQud2VhdGhlckNvdW50ZXIgPSBuZXdEYXlOdW1iZXI7XHJcbiAgICBjYXJkLmRhdGFzZXQuY2FyZE51bWJlcjtcclxuICAgIGNhcmQuZGF0YXNldC5jYXJkTnVtYmVyID0gMDtcclxuICAgIGNhcmQuY2xhc3NMaXN0LmFkZChgbmV3LWNhcmQtbnVtYmVyLTBgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLUFQSV9fY2FyZHNgKS5wcmVwZW5kKGNhcmQpO1xyXG5cclxuICAgIGxldCBjYXJkSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xyXG4gICAgY2FyZEluZm8uY2xhc3NMaXN0LmFkZChgd2VhdGhlci1jYXJkX19pbmZvYCk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkYCkucHJlcGVuZChjYXJkSW5mbyk7XHJcblxyXG4gICAgbGV0IGNhcmRQbGFjZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xyXG4gICAgY2FyZFBsYWNlLmNsYXNzTGlzdC5hZGQoYHdlYXRoZXItY2FyZF9fcGxhY2VgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX2luZm9gKS5wcmVwZW5kKGNhcmRQbGFjZSk7XHJcblxyXG4gICAgbGV0IGNhcmRDaXR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XHJcbiAgICBjYXJkQ2l0eS5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX2NpdHlgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX3BsYWNlYCkucHJlcGVuZChjYXJkQ2l0eSk7XHJcblxyXG4gICAgbGV0IGNhcmRDb3VudHJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgc3VwYCk7XHJcbiAgICBjYXJkQ291bnRyeS5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX2NvdW50cnlgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX2NpdHlgKS5hZnRlcihjYXJkQ291bnRyeSk7XHJcblxyXG4gICAgbGV0IGNhcmRUaW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XHJcbiAgICBjYXJkVGltZS5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX3RpbWVgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX3BsYWNlYCkuYWZ0ZXIoY2FyZFRpbWUpO1xyXG5cclxuICAgIGxldCBjYXJkVGVtcGVyYXR1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBkaXZgKTtcclxuICAgIGNhcmRUZW1wZXJhdHVyZS5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX3RlbXBlcmF0dXJlYCk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkX190aW1lYCkuYWZ0ZXIoY2FyZFRlbXBlcmF0dXJlKTtcclxuXHJcbiAgICBsZXQgdGVtcGVyYXR1cmVSZWFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XHJcbiAgICB0ZW1wZXJhdHVyZVJlYWwuY2xhc3NMaXN0LmFkZChgd2VhdGhlci1jYXJkX19yZWFsLWRlZ3JlZWApO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZF9fdGVtcGVyYXR1cmVgKS5wcmVwZW5kKHRlbXBlcmF0dXJlUmVhbCk7XHJcblxyXG4gICAgbGV0IHRlbXBlcmF0dXJlRmVlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xyXG4gICAgdGVtcGVyYXR1cmVGZWVsLmNsYXNzTGlzdC5hZGQoYHdlYXRoZXItY2FyZF9fZmVlbHMtZGVncmVlYCk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkX19yZWFsLWRlZ3JlZWApLmFmdGVyKHRlbXBlcmF0dXJlRmVlbCk7XHJcblxyXG4gICAgbGV0IGJ1dHRvbkFkZERheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGJ1dHRvbmApO1xyXG4gICAgYnV0dG9uQWRkRGF5LmNsYXNzTGlzdC5hZGQoYHdlYXRoZXItQVBJX19hZGROZXdEYXlgKTtcclxuICAgIGJ1dHRvbkFkZERheS50ZXh0Q29udGVudCA9IGBhZGQgbmV3IGRheWA7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1BUElfX2NhcmRzYCkuYWZ0ZXIoYnV0dG9uQWRkRGF5KTtcclxuXHJcbiAgICBsZXQgY2hhbmdlSG91cnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBkaXZgKTtcclxuICAgIGNoYW5nZUhvdXJzLmNsYXNzTGlzdC5hZGQoYHdlYXRoZXItY2FyZF9fY2hhbmdlSG91cnNgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX2luZm9gKS5hZnRlcihjaGFuZ2VIb3Vycyk7XHJcblxyXG4gICAgbGV0IGJ1dHRvblBsdXMzSG91cnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTtcclxuICAgIGJ1dHRvblBsdXMzSG91cnMudGV4dENvbnRlbnQgPSBgKzMgaG91cnNgO1xyXG4gICAgYnV0dG9uUGx1czNIb3Vycy5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX3BsdXMzSG91cnNgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX2NoYW5nZUhvdXJzYCkucHJlcGVuZChidXR0b25QbHVzM0hvdXJzKTtcclxuXHJcbiAgICBsZXQgYnV0dG9uTWludXMzSG91cnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTtcclxuICAgIGJ1dHRvbk1pbnVzM0hvdXJzLnRleHRDb250ZW50ID0gYC0zIGhvdXJzYDtcclxuICAgIGJ1dHRvbk1pbnVzM0hvdXJzLmNsYXNzTGlzdC5hZGQoYHdlYXRoZXItY2FyZF9fbWludXMzSG91cnNgKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX3BsdXMzSG91cnNgKS5iZWZvcmUoYnV0dG9uTWludXMzSG91cnMpO1xyXG5cclxuICAgIGxldCB3ZWF0aGVySWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xyXG4gICAgd2VhdGhlckljb24uY2xhc3NMaXN0LmFkZChgd2VhdGhlci1jYXJkX19pY29uYCk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkX190ZW1wZXJhdHVyZWApLmFmdGVyKHdlYXRoZXJJY29uKTtcclxuXHJcbiAgICBsZXQgY2FyZFN0YXR1cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xyXG4gICAgY2FyZFN0YXR1cy5jbGFzc0xpc3QuYWRkKGB3ZWF0aGVyLWNhcmRfX3N0YXR1c2ApO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZF9faWNvbmApLmFmdGVyKGNhcmRTdGF0dXMpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGluZm8ud2VhdGhlclswXS5pY29uKVxyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX2NpdHlgKS50ZXh0Q29udGVudCA9IGNpdHkuY2l0eS5uYW1lO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZF9fY291bnRyeWApLnRleHRDb250ZW50ID0gY2l0eS5jaXR5LmNvdW50cnk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkX190aW1lYCkudGV4dENvbnRlbnQgPSBpbmZvLmR0X3R4dDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRfX3JlYWwtZGVncmVlYCkuaW5uZXJIVE1MID0gKGluZm8ubWFpbi50ZW1wIC0gMjczKS50b0ZpeGVkKDEpICsgYCZkZWdgO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZF9fZmVlbHMtZGVncmVlYCkuaW5uZXJIVE1MID0gYGZlZWxzIGxpa2U6IGAgKyAoaW5mby5tYWluLmZlZWxzX2xpa2UgLSAyNzMpLnRvRml4ZWQoMSkgKyBgJmRlZ2A7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1jYXJkX19pY29uYCkuaW5uZXJIVE1MID0gYDxpbWcgc3JjPSdodHRwczovL29wZW53ZWF0aGVybWFwLm9yZy9pbWcvd24vJHtpbmZvLndlYXRoZXJbMF0uaWNvbn1AMngucG5nJz5gO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZF9fc3RhdHVzYCkudGV4dENvbnRlbnQgPSBpbmZvLndlYXRoZXJbMF1bJ2Rlc2NyaXB0aW9uJ107XHJcbn1cclxuXHJcbmxldCBuZXdJbmZvQ2FyZCA9IGZ1bmN0aW9uIChpbmZvLCBidXR0b24gPSBmYWxzZSkge1xyXG4gICAgbGV0IG91dHB1dENhcmQ7XHJcblxyXG4gICAgaWYgKGJ1dHRvbikge1xyXG4gICAgICAgIG91dHB1dENhcmQgPSBidXR0b24udGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3RbMV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBuZXdDYXJkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XHJcbiAgICAgICAgbmV3Q2FyZERpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC53ZWF0aGVyLWNhcmRgKS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgbmV3Q2FyZERpdi5jbGFzc0xpc3QucmVtb3ZlKGBuZXctY2FyZC1udW1iZXItMGApO1xyXG4gICAgICAgIG5ld0NhcmREaXYuY2xhc3NMaXN0LmFkZChgbmV3LWNhcmQtbnVtYmVyLSR7Y291bnRPZkRheXN9YCk7XHJcbiAgICAgICAgbmV3Q2FyZERpdi5kYXRhc2V0LmNhcmROdW1iZXIgPSBjb3VudE9mRGF5cztcclxuICAgICAgICBuZXdDYXJkRGl2LmRhdGFzZXQud2VhdGhlckNvdW50ZXIgPSBuZXdEYXlOdW1iZXI7XHJcbiAgICAgICAgKGNvdW50T2ZEYXlzID09IDEpID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItY2FyZGApLmFmdGVyKG5ld0NhcmREaXYpIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLm5ldy1jYXJkLW51bWJlci0ke2NvdW50T2ZEYXlzIC0gMX1gKS5hZnRlcihuZXdDYXJkRGl2KTtcclxuICAgICAgICBvdXRwdXRDYXJkID0gYG5ldy1jYXJkLW51bWJlci0ke2NvdW50T2ZEYXlzfWA7XHJcbiAgICB9XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7b3V0cHV0Q2FyZH0gPiAud2VhdGhlci1jYXJkX19pbmZvID4gLndlYXRoZXItY2FyZF9fdGltZWApLmlubmVySFRNTCA9IGluZm8uZHRfdHh0O1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7b3V0cHV0Q2FyZH0gPiAud2VhdGhlci1jYXJkX19pbmZvID4gLndlYXRoZXItY2FyZF9fdGVtcGVyYXR1cmUgPiAud2VhdGhlci1jYXJkX19yZWFsLWRlZ3JlZWApLmlubmVySFRNTCA9IChpbmZvLm1haW4udGVtcCAtIDI3MykudG9GaXhlZCgxKSArIGAmZGVnYDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke291dHB1dENhcmR9ID4gLndlYXRoZXItY2FyZF9faW5mbyA+IC53ZWF0aGVyLWNhcmRfX3RlbXBlcmF0dXJlID4gLndlYXRoZXItY2FyZF9fZmVlbHMtZGVncmVlYCkuaW5uZXJIVE1MID0gYGZlZWxzIGxpa2U6IGAgKyAoaW5mby5tYWluLmZlZWxzX2xpa2UgLSAyNzMpLnRvRml4ZWQoMSkgKyBgJmRlZ2A7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtvdXRwdXRDYXJkfSA+IC53ZWF0aGVyLWNhcmRfX2luZm8gPiAud2VhdGhlci1jYXJkX19pY29uYCkuaW5uZXJIVE1MID0gYDxpbWcgc3JjPSdodHRwczovL29wZW53ZWF0aGVybWFwLm9yZy9pbWcvd24vJHtpbmZvLndlYXRoZXJbMF0uaWNvbn1AMngucG5nJz5gO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7b3V0cHV0Q2FyZH0gPiAud2VhdGhlci1jYXJkX19pbmZvID4gLndlYXRoZXItY2FyZF9fc3RhdHVzYCkuaW5uZXJIVE1MID0gaW5mby53ZWF0aGVyWzBdW2BkZXNjcmlwdGlvbmBdO1xyXG59XHJcblxyXG5sZXQgZ2V0V2VhdGhlciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICBmZXRjaChgJHthcGkudXJsfWZvcmVjYXN0P3E9JHtlfSZpbml0cz1tZXRyaWMmQVBQSUQ9JHthcGkua2V5fWApXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLnN0YXR1cyA+PSAyMDAgJiYgcmVzLnN0YXR1cyA8IDMwMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCBlcnJvciA9IG5ldyBFcnJvcihyZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgICAgICAgICAgICBlcnJvci5yZXNwb25zZSA9IHJlcztcclxuICAgICAgICAgICAgICAgIHRocm93IGVycm9yXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiBkYXRhLmpzb24oKSB9KVxyXG4gICAgICAgIC50aGVuKGRpc3BsYXlXZWF0aGVyKVxyXG4gICAgICAgIC5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6IGAgKyBlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlLnJlc3BvbnNlKTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGlzcGxheVdlYXRoZXIoZGF0YSkge1xyXG4gICAgbGV0IGFsbENhcmRzQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1BUElfX2NhcmRzYClcclxuXHJcbiAgICB3aGlsZSAoYWxsQ2FyZHNCbG9jay5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgYWxsQ2FyZHNCbG9jay5yZW1vdmVDaGlsZChhbGxDYXJkc0Jsb2NrLmZpcnN0Q2hpbGQpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlRmlyc3RDYXJkKGRhdGEsIGRhdGEubGlzdFswXSk7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLndlYXRoZXItQVBJX19hZGROZXdEYXlgKS5vbmNsaWNrID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgbGV0IGRheSA9ICtkYXRhLmxpc3RbbmV3RGF5TnVtYmVyXS5kdF90eHQuc3BsaXQoYCBgLCAyKVswXS5zcGxpdChgLWApWzJdO1xyXG4gICAgICAgIGxldCBtb3VudGggPSArZGF0YS5saXN0W25ld0RheU51bWJlcl0uZHRfdHh0LnNwbGl0KGAtYCwgMilbMV07XHJcbiAgICAgICAgbGV0IHllYXIgPSArZGF0YS5saXN0W25ld0RheU51bWJlcl0uZHRfdHh0LnNwbGl0KGAtYCwgMilbMF07XHJcbiAgICAgICAgY291bnRPZkRheXMrKztcclxuICAgICAgICBpZiAoY291bnRPZkRheXMgPCA0KSB7XHJcbiAgICAgICAgICAgIGxldCBuZXh0RGF5SW5mbyA9IChkYXRhLmxpc3QpLmZpbmQoKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3RGF5ID0gaXRlbS5kdF90eHQuc3BsaXQoYCBgLCAyKVswXS5zcGxpdChgLWApWzJdO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld01vdW50aCA9IGl0ZW0uZHRfdHh0LnNwbGl0KGAtYCwgMilbMV07XHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3WWVhciA9IGl0ZW0uZHRfdHh0LnNwbGl0KGAtYCwgMilbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgbmV3RGF5TnVtYmVyID0gaW5kZXg7XHJcbiAgICAgICAgICAgICAgICBpZiAoKG5ld0RheSA8IGRheSAmJiBuZXdNb3VudGggPiBtb3VudGgpIHx8IChuZXdEYXkgPiBkYXkgJiYgbmV3TW91bnRoID09IG1vdW50aCkgfHwgKG5ld1llYXIgPiB5ZWFyICYmIG5ld01vdW50aCA8IG1vdW50aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG5ld0luZm9DYXJkKG5leHREYXlJbmZvKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBldmVudC50YXJnZXQuc3R5bGUuZGlzcGxheSA9IGBub25lYDtcclxuICAgICAgICAgICAgY291bnRPZkRheXMgPSAwO1xyXG4gICAgICAgICAgICBuZXdEYXlOdW1iZXIgPSAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAud2VhdGhlci1BUElfX2NhcmRzYCkub25jbGljayA9IChlKSA9PiB7XHJcbiAgICAgICAgaWYgKGUudGFyZ2V0Lm1hdGNoZXMoYGJ1dHRvbi53ZWF0aGVyLWNhcmRfX3BsdXMzSG91cnNgKSkge1xyXG4gICAgICAgICAgICBsZXQgbmV4ID0gK2UudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoYGRhdGEtd2VhdGhlci1jb3VudGVyYCk7XHJcbiAgICAgICAgICAgIGxldCBkYXkgPSArZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7ZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdFsxXX0gPiAud2VhdGhlci1jYXJkX19pbmZvID4gLndlYXRoZXItY2FyZF9fdGltZWApLnRleHRDb250ZW50LnNwbGl0KGAgYCwgMilbMF0uc3BsaXQoYC1gKVsyXTtcclxuICAgICAgICAgICAgbGV0IGhvdXIgPSArZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7ZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdFsxXX0gPiAud2VhdGhlci1jYXJkX19pbmZvID4gLndlYXRoZXItY2FyZF9fdGltZWApLnRleHRDb250ZW50LnNwbGl0KGAgYCwgMilbMV0uc3BsaXQoYDpgKVswXTtcclxuICAgICAgICAgICAgbGV0IG5leHRIb3VySW5mbyA9IChkYXRhLmxpc3QpLmZpbmQoKGl0ZW0sIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICgoK2l0ZW0uZHRfdHh0LnNwbGl0KGAgYCwgMilbMV0uc3BsaXQoYDpgKVswXSA+IGhvdXIpICYmICgraXRlbS5kdF90eHQuc3BsaXQoYCBgLCAyKVswXS5zcGxpdChgLWApWzJdID09PSBkYXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCtgKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChuZXh0SG91ckluZm8gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3SW5mb0NhcmQobmV4dEhvdXJJbmZvLCBlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0Lm1hdGNoZXMoYGJ1dHRvbi53ZWF0aGVyLWNhcmRfX21pbnVzM0hvdXJzYCkpIHtcclxuICAgICAgICAgICAgbGV0IG5leCA9ICtlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKGBkYXRhLXdlYXRoZXItY291bnRlcmApO1xyXG4gICAgICAgICAgICBsZXQgZGF5ID0gK2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2UudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3RbMV19ID4gLndlYXRoZXItY2FyZF9faW5mbyA+IC53ZWF0aGVyLWNhcmRfX3RpbWVgKS50ZXh0Q29udGVudC5zcGxpdChgIGAsIDIpWzBdLnNwbGl0KGAtYClbMl07XHJcbiAgICAgICAgICAgIGxldCBob3VyID0gK2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2UudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3RbMV19ID4gLndlYXRoZXItY2FyZF9faW5mbyA+IC53ZWF0aGVyLWNhcmRfX3RpbWVgKS50ZXh0Q29udGVudC5zcGxpdChgIGAsIDIpWzFdLnNwbGl0KGA6YClbMF07XHJcblxyXG4gICAgICAgICAgICBsZXQgbmV4dEhvdXJJbmZvID0gKGRhdGEubGlzdCkuZmluZCgoaXRlbSwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCgoaG91ciAtICtpdGVtLmR0X3R4dC5zcGxpdChgIGAsIDIpWzFdLnNwbGl0KGA6YClbMF0pID09PSAzKSAmJiAoK2l0ZW0uZHRfdHh0LnNwbGl0KGAgYCwgMilbMF0uc3BsaXQoYC1gKVsyXSA9PT0gZGF5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAtYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5leHRIb3VySW5mbyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZXdJbmZvQ2FyZChuZXh0SG91ckluZm8sIGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=
